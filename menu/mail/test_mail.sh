#!/bin/bash

# é¢œè‰²å®šä¹‰
blue="\033[1;34m"
green="\033[1;32m"
yellow="\033[1;33m"
red="\033[1;31m"
orange="\033[38;5;214m"
cyan="\033[1;36m"
magenta="\033[1;35m"
reset="\033[0m"

cecho() {
  local color=$1
  shift
  echo -e "${color}$*${reset}"
}

test_smtp() {
  clear
  echo -e "${cyan}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${reset}"
  echo -e "$orange" "                                 ğŸ“§ SMTPæµ‹è¯•${reset}"
  echo -e "${cyan}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${reset}"
  
  read -p "$(echo -e "${yellow}âœ¨ è¯·è¾“å…¥å‘ä»¶äººé‚®ç®±: ${reset}")" from
  echo -e "${blue}ğŸ“ è¾“å…¥ä¸º: ${green}$from${reset}"
  
  read -p "$(echo -e "${yellow}âœ¨ è¯·è¾“å…¥æ”¶ä»¶äººé‚®ç®±: ${reset}")" to
  echo -e "${blue}ğŸ“ è¾“å…¥ä¸º: ${green}$to${reset}"
  
  read -p "$(echo -e "${yellow}âœ¨ è¯·è¾“å…¥é‚®ä»¶ä¸»é¢˜: ${reset}")" subject
  echo -e "${blue}ğŸ“ è¾“å…¥ä¸º: ${green}$subject${reset}"
  
  read -p "$(echo -e "${yellow}âœ¨ è¯·è¾“å…¥é‚®ä»¶å†…å®¹: ${reset}")" body
  echo -e "${blue}ğŸ“ è¾“å…¥ä¸º: ${green}$body${reset}"
  
  echo -e "${blue}ğŸ“¤ æ­£åœ¨å‘é€æµ‹è¯•é‚®ä»¶...${reset}"
  echo "$body" | mail -s "$subject" -r "$from" "$to"
  
  if [ $? -eq 0 ]; then
    echo -e "${green}âœ… æµ‹è¯•é‚®ä»¶å·²å‘é€!${reset}"
  else
    echo -e "${red}âœ— é‚®ä»¶å‘é€å¤±è´¥!${reset}"
  fi
  
  echo -e "${cyan}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${reset}"
  
  read -p "$(echo -e "ğŸ’¬ ${cyan}æŒ‰å›è½¦é”®è¿”å›...${reset}")" dummy
  test_menu
}

test_imap() {
  clear
  echo -e "${cyan}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${reset}"
  echo -e "$orange" "                                 ğŸ“¥ IMAPæµ‹è¯•${reset}"
  echo -e "${cyan}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${reset}"
  
  read -p "$(echo -e "${yellow}âœ¨ è¯·è¾“å…¥é‚®ç®±åœ°å€: ${reset}")" email
  echo -e "${blue}ğŸ“ è¾“å…¥ä¸º: ${green}$email${reset}"
  
  read -p "$(echo -e "${yellow}âœ¨ è¯·è¾“å…¥å¯†ç : ${reset}")" -s password
  echo -e "\n${blue}ğŸ“ è¾“å…¥ä¸º: ${green}[å¯†ç å·²éšè—]${reset}"
  
  hostname=$(grep "myhostname" /etc/postfix/main.cf | awk -F "= " '{print $2}')
  
  echo -e "${blue}ğŸ”’ æ­£åœ¨æµ‹è¯•IMAPè¿æ¥...${reset}"
  curl -k --url "imaps://$hostname" --user "$email:$password"
  
  if [ $? -eq 0 ]; then
    echo -e "${green}âœ… IMAPè¿æ¥æˆåŠŸ!${reset}"
  else
    echo -e "${red}âœ— IMAPè¿æ¥å¤±è´¥!${reset}"
  fi
  
  echo -e "${cyan}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${reset}"
  
  read -p "$(echo -e "ğŸ’¬ ${cyan}æŒ‰å›è½¦é”®è¿”å›...${reset}")" dummy
  test_menu
}

test_webmail() {
  clear
  echo -e "${cyan}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${reset}"
  echo -e "$orange" "                                 ğŸŒ Webmailæµ‹è¯•${reset}"
  echo -e "${cyan}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${reset}"
  
  hostname=$(grep "myhostname" /etc/postfix/main.cf | awk -F "= " '{print $2}')
  echo -e "${blue}ğŸŒ Webmailè®¿é—®åœ°å€: ${yellow}https://$hostname/roundcube${reset}"
  echo -e "${blue}ğŸ–¥ï¸ è¯·ä½¿ç”¨æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€æµ‹è¯•WebmailåŠŸèƒ½${reset}"
  
  echo -e "${cyan}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${reset}"
  
  read -p "$(echo -e "ğŸ’¬ ${cyan}æŒ‰å›è½¦é”®è¿”å›...${reset}")" dummy
  test_menu
}

test_menu() {
  clear
  echo -e "${cyan}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${reset}"
  echo -e "$orange" "                                 ğŸ§ª é‚®ä»¶ç³»ç»Ÿæµ‹è¯•${reset}"
  echo -e "${cyan}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${reset}"
  echo -e "${green}â‘  æµ‹è¯•SMTPå‘é€${reset}"
  echo -e "${green}â‘¡ æµ‹è¯•IMAPæ¥æ”¶${reset}"
  echo -e "${green}â‘¢ æµ‹è¯•Webmailè®¿é—®${reset}"
  echo -e "${green}â‘£ è¿”å›ä¸»èœå•${reset}"
  echo -e "${cyan}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${reset}"
  
  read -p "$(echo -e "${yellow}âœ¨ è¯·é€‰æ‹©æµ‹è¯•ç±»å‹ [1-4]: ${reset}")" choice
  case $choice in
    1) test_smtp ;;
    2) test_imap ;;
    3) test_webmail ;;
    4) bash /root/VPN/menu/mail.sh ;;
    *) echo -e "${red}âœ— æ— æ•ˆé€‰æ‹©!${reset}"; sleep 1; test_menu ;;
  esac
}

test_menu
